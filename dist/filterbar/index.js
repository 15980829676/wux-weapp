"use strict";var _baseComponent=_interopRequireDefault(require("../helpers/baseComponent")),_classNames=_interopRequireDefault(require("../helpers/classNames")),_index=require("../index");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(0,_baseComponent.default)({properties:{prefixCls:{type:String,value:"wux-filterbar"},items:{type:Array,value:[]}},computed:{classes:["prefixCls",function(e){return{wrap:(0,_classNames.default)(e),bd:"".concat(e,"__bd"),item:"".concat(e,"__item"),text:"".concat(e,"__text"),icon:"".concat(e,"__icon"),pop:"".concat(e,"__pop"),scrollView:"".concat(e,"__scroll-view"),panel:"".concat(e,"__panel"),panelHd:"".concat(e,"__panel-hd"),panelTitle:"".concat(e,"__panel-title"),panelSelected:"".concat(e,"__panel-selected"),panelBd:"".concat(e,"__panel-bd"),groups:"".concat(e,"__groups"),group:"".concat(e,"__group"),radio:"".concat(e,"__radio"),btn:"".concat(e,"__btn"),check:"".concat(e,"__check"),btns:"".concat(e,"__btns"),select:"".concat(e,"__select")}}]},methods:{onReset:function(e,t){var n=e.currentTarget.dataset,c=n.index,i=n.item,o=t&&t.children||i.children.map(function(e){return Object.assign({},e,{children:e.children.map(function(e){return Object.assign({},e,{checked:!1})}),selected:""})});this.setData(_defineProperty({},"options[".concat(c,"].children"),o))},onClose:function(e,t){var n=this,c=e.currentTarget.dataset.index,i=_defineProperty({},"options[".concat(c,"].visible"),!1);this.setData(i,function(){"function"==typeof t?t.call(n,e):n.onReset(e,n.prevState),n.$wuxBackdrop.release()})},onConfirm:function(e){this.onClose(e,this.onChange)},onRadioChange:function(e){var t,n=e.detail.value,c=e.currentTarget.dataset,i=c.index,o=c.item,r=c.parentIndex,a=o.children.map(function(e){return Object.assign({},e,{checked:e.value===n})}),s=a.filter(function(e){return e.checked}).map(function(e){return e.label}).join(",");this.setData((_defineProperty(t={},"options[".concat(r,"].children[").concat(i,"].children"),a),_defineProperty(t,"options[".concat(r,"].children[").concat(i,"].selected"),s),t))},onCheckboxChange:function(e){var t,n=e.detail.value,c=e.currentTarget.dataset,i=c.index,o=c.item,r=c.parentIndex,a=o.children.map(function(e){return Object.assign({},e,{checked:n.includes(e.value)})}),s=a.filter(function(e){return e.checked}).map(function(e){return e.label}).join(",");this.setData((_defineProperty(t={},"options[".concat(r,"].children[").concat(i,"].children"),a),_defineProperty(t,"options[".concat(r,"].children[").concat(i,"].selected"),s),t))},radioChange:function(e){var t=e.detail.value,n=e.currentTarget.dataset,c=n.index,i=n.item.children.map(function(e){return Object.assign({},e,{checked:e.value===t})}),o=_defineProperty({},"options[".concat(c,"].children"),i);this.setData(o,this.onChange)},checkboxChange:function(e){var t=e.detail.value,n=e.currentTarget.dataset,c=n.index,i=n.item,o=i.children.filter(function(e){return e.checked}).map(function(e){return e.value}),r=i.children.map(function(e){return Object.assign({},e,{checked:e.value===t?!o.includes(e.value):e.checked})}),a=_defineProperty({},"options[".concat(c,"].children"),r);this.setData(a,this.onChange)},onClick:function(e){var t=e.currentTarget.dataset.index;this.onOpenSelect(this.data.options,t)},onOpenSelect:function(e,t){var i=this,n=0<arguments.length&&void 0!==e?e:[],o=1<arguments.length&&void 0!==t?t:0,r=n[o],c=n.map(function(e,t){var n=Object.assign({},e,{checked:o===t&&!e.checked});if(e.checked){var c=i.getDifference(e.groups,r.groups);n.checked=!!c.length,o===t||c.length||("object"===_typeof(n.children)&&(["radio","checkbox"].includes(e.type)&&(n.children=n.children.map(function(e){return Object.assign({},e,{checked:!1})})),["filter"].includes(e.type)&&(n.children=n.children.map(function(e){return Object.assign({},e,{children:e.children.map(function(e){return Object.assign({},e,{checked:!1})}),selected:""})}))),["sort"].includes(e.type)&&(n.sort=void 0))}return["radio","checkbox","filter"].includes(e.type)&&(n.visible=o===t&&!e.visible,"filter"===e.type&&i.$wuxBackdrop[o===t?e.visible?"release":"retain":"release"]()),o===t&&["sort"].includes(e.type)&&(n.sort="number"==typeof n.sort?-n.sort:1),n});this.setData({options:c,index:o},function(){i.prevState=r,["radio","checkbox","filter"].includes(r.type)||i.onChange()})},onCloseSelect:function(){var e=this.data.options,n={};e.forEach(function(e,t){e.checked&&e.visible&&(n["options[".concat(t,"].visible")]=!1)}),this.setData(n)},getDifference:function(e,t){var n=1<arguments.length&&void 0!==t?t:[];return(0<arguments.length&&void 0!==e?e:[]).filter(function(e){return n.includes(e)})},onChange:function(){var n=this;setTimeout(function(){var e=n.data.options,t=e.filter(function(e){return e.checked});n.onCloseSelect(),n.triggerEvent("change",{checkedItems:t,items:e})},300)},onScroll:function(e){this.triggerEvent("scroll",e)},onEnter:function(e){this.triggerEvent("open",e)},onExit:function(e){this.triggerEvent("close",e)}},created:function(){this.$wuxBackdrop=(0,_index.$wuxBackdrop)("#wux-backdrop",this)},attached:function(){this.setData({options:this.data.items})}});